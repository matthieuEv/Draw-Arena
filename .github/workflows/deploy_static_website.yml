name: ðŸš€ Deploy static website

on:
  workflow_dispatch:
  push:
    tags:
      - 'v*..'

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: azure
    steps:
      - uses: actions/checkout@v4

      - name: Remove unused files
        run: |
          rm -f ./frontend/README.md
          rm -f ./frontend/nginx.conf

      - name: Get Account Name
        run: |
          # echo "ACCOUNT_NAME=drawarenastatic2026" >> $GITHUB_ENV
          echo "ACCOUNT_NAME=drawarenastaticpreprod" >> $GITHUB_ENV

      - name: Upload to $web (Storage key)
        run: |
          az storage blob upload-batch \
            --account-name "${{ env.ACCOUNT_NAME }}" \
            --account-key "${{ secrets.AZURE_STORAGE_KEY_PREPROD }}" \
            --destination '$web' \
            --source ./frontend \
            --overwrite

      - name: Write summary
        run: |
          echo "## ðŸš€ Deployment info" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Website deployed to https://${{ env.ACCOUNT_NAME }}.z28.web.core.windows.net" >> $GITHUB_STEP_SUMMARY
